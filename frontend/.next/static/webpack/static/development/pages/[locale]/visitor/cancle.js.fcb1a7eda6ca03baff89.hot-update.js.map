{"version":3,"file":"static/webpack/static/development/pages/[locale]/visitor/cancle.js.fcb1a7eda6ca03baff89.hot-update.js","sources":["webpack:///./components/CancleVisit/index.tsx","webpack:///./hooks/useTableSearch.tsx"],"sourcesContent":["import * as React from 'react';\nimport moment from 'moment';\nimport { Grid, Typography } from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport useRestClient from '../../hooks/useRestClient';\nimport useTableSearch from '../../hooks/useTableSearch';\nimport useTranslations from '../../hooks/useTranslations';\nimport Table from '../Table';\nimport useStyles from './style';\nimport { GetBesucherByFilterInput, TableState } from '../../types';\n\nfunction mapStateToReqBody(\n  state: Omit<TableState, 'Rows'>\n): GetBesucherByFilterInput {\n  return {\n    skip: state.skip,\n    take: state.limit,\n    startzeit: state.search.startDate,\n    endzeit: state.search.endDate,\n  };\n}\n\nconst CancleVisit: React.FunctionComponent = () => {\n  const reducer = useTableSearch<any>();\n  const { client, setIsLoading, setHasError } = useRestClient();\n  if (!reducer) return null;\n\n  const { state, dispatch } = reducer;\n\n  async function getBesuchByFilter() {\n    const res = await client.getBesuchByFilter(mapStateToReqBody(state));\n    if (res)\n      dispatch({\n        type: 'setRows',\n        payload: {\n          rows: res.map(p => ({\n            id: p.id,\n            'start-date': `${moment(p.startzeit).format('DD.MM.YYYY, HH:mm')}`,\n            name: `${p.besucher[0].person.name}, ${p.besucher[0].person.vorname}`,\n            'property-rooms': p.raeume.map(r => `${r.bezeichnung}`).join(', '),\n          })),\n          count: res.length,\n        },\n      });\n  }\n\n  async function setBesuchEndzeitpunkt(ids: Array<string | number>) {\n    setIsLoading(true);\n    try {\n      for (const id of ids) {\n        await client.setBesuchEndzeitpunkt({\n          besuchId: Number(id),\n          endzeit: moment().toISOString(),\n        });\n      }\n      await getBesuchByFilter();\n    } catch (error) {\n      setIsLoading(false);\n      setHasError(true);\n    }\n  }\n\n  React.useEffect(() => {\n    getBesuchByFilter();\n  }, [state.page, state.limit]);\n\n  const classes = useStyles();\n  const { t } = useTranslations();\n  return (\n    <div className={classes.root}>\n      <Grid container spacing={4}>\n        <Grid item xs={12} sm={6}>\n          <Typography variant=\"body1\">{t('administration')}</Typography>\n          <Typography variant=\"h6\">{t('visitor-cancle')}</Typography>\n        </Grid>\n      </Grid>\n      <Grid container spacing={4}>\n        <Grid item xs={12}>\n          <Table\n            rows={state.rows}\n            rowsPerPageOptions={[25, 50, 100]}\n            count={state.count}\n            rowsPerPage={state.limit}\n            page={state.page}\n            onChangePage={(_: any, newPage: number) => {\n              const newSkip =\n                newPage > state.page\n                  ? state.skip + state.limit\n                  : state.skip - state.limit;\n              dispatch({\n                type: 'changePage',\n                payload: { skip: newSkip, page: newPage },\n              });\n            }}\n            onChangeRowsPerPage={event => {\n              const limit = Number(event.target.value);\n              dispatch({ type: 'changeRowsPerPage', payload: { limit } });\n            }}\n            uniqueId=\"id\"\n            toolbarSettings={{\n              title: t('visitor-current-registered'),\n              tooltipSelected: {\n                title: t('visitor-cancle'),\n                icon: <InputIcon />,\n                onClick: async ids => setBesuchEndzeitpunkt(ids),\n              },\n            }}\n          />\n        </Grid>\n      </Grid>\n    </div>\n  );\n};\n\nexport default CancleVisit;\n","import * as React from 'react';\nimport { TableState, TableAction } from '../types';\n\nconst createTableReducer = <R,>() => (\n  state: TableState<R>,\n  action: TableAction<R>\n) => {\n  switch (action.type) {\n    case 'setRows': {\n      if (action.payload.count)\n        return {\n          ...state,\n          rows: action.payload.rows,\n          count: action.payload.count,\n        };\n      else return { ...state, rows: action.payload.rows };\n    }\n    case 'changePage':\n      return { ...state, page: action.payload.page, skip: action.payload.skip };\n    case 'changeRowsPerPage':\n      return { ...state, limit: action.payload.limit };\n    case 'setSearch': {\n      return { ...state, search: action.payload };\n    }\n\n    default:\n      return state;\n  }\n};\n\nfunction useSearchStateReducer<R>() {\n  const tableReducer = createTableReducer<R>();\n  const [state, dispatch] = React.useReducer(tableReducer, {\n    skip: 0,\n    limit: 50,\n    count: 0,\n    page: 0,\n    rows: [],\n    search: null,\n  });\n\n  return { state, dispatch };\n}\n\nexport default useSearchStateReducer;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AAEA;AAHA;AAAA;AACA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAJA;AAAA;AAMA;AAPA;AAFA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAgBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAHA;AAAA;AAKA;AACA;AAFA;AACA;AALA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAWA;AACA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAeA;AACA;AACA;AAEA;AACA;AA7CA;AAAA;AACA;AA6CA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AAFA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAFA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AClHA;AACA;AAEA;AAAA;AAIA;AACA;AAAA;AACA;AAGA;AACA;AAHA;AAKA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAnBA;AAqBA;AAzBA;AACA;AA0BA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAAA;AAAA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;A","sourceRoot":""}