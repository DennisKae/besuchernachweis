{"version":3,"file":"static/webpack/static/development/pages/[locale]/visitor/register.js.c59955708adb17bf464e.hot-update.js","sources":["webpack:///./components/RegisterVisit/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport {\n  Grid,\n  Typography,\n  Paper,\n  Input,\n  InputLabel,\n  FormControl,\n  Select,\n  MenuItem,\n  Button,\n} from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport Table from '../Table';\nimport useRestClient from '../../hooks/useRestClient';\nimport useTableSearch from '../../hooks/useTableSearch';\nimport useTranslations from '../../hooks/useTranslations';\nimport useStyles from './style';\n\nconst INITIAL_FORM_STATE = {\n  id: null,\n  firstName: '',\n  name: '',\n  email: '',\n  phone: '',\n  building: 0,\n  rooms: [],\n  permissionGranted: false,\n};\n\nconst RegisterVisit: React.FunctionComponent = () => {\n  // hooks\n  const classes = useStyles();\n  const reducer = useTableSearch<any>();\n  const { t } = useTranslations();\n  const { client } = useRestClient();\n  if (!reducer) return null;\n\n  const { state, dispatch } = reducer;\n\n  async function getBesucherByFilter() {\n    const res = await client.getBesucherByFilter({\n      skip: state.skip,\n      take: state.limit,\n    });\n\n    if (res)\n      dispatch({\n        type: 'setRows',\n        payload: {\n          rows: res.map((r: any) => ({\n            id: r.id,\n            vorname: 'Max',\n            nachname: 'Mustermann',\n            email: 'max@mustermann.de',\n          })),\n          count: res.length,\n        },\n      });\n  }\n\n  React.useEffect(() => {\n    getBesucherByFilter();\n  }, [state.page, state.limit]);\n\n  const [buildings, setBuildings] = React.useState<any>(null);\n\n  React.useEffect(() => {\n    async function getGebauede() {\n      const res = await client.getGebauede();\n      if (res) setBuildings(res);\n    }\n    getGebauede();\n  }, []);\n\n  const [rooms, setRooms] = React.useState<any>([]);\n  const [formState, setFormState] = React.useState<any>(INITIAL_FORM_STATE);\n\n  async function postBesucher() {\n    let id: number = formState.id;\n    if (!id) {\n      const res = await client.registerBesucher({\n        person: {\n          name: formState.name,\n          vorname: formState.firstName,\n          email: formState.email,\n          telefon: formState.phone,\n        },\n        gesundheitsstatus: 'gesund',\n      });\n      if (res && res.id) {\n        id = res.id;\n      }\n    }\n    const res = await client.registerBesuch({\n      besucher: [id],\n      raeume: formState.rooms,\n    });\n  }\n\n  return (\n    <div className={classes.root}>\n      <Grid container spacing={4}>\n        <Grid item xs={12} sm={6}>\n          <Typography variant=\"body1\">{t('administration')}</Typography>\n          <Typography variant=\"h6\">{t('visitor-register')}</Typography>\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <Typography variant=\"body1\">Registrieter Besucher</Typography>\n          <Typography variant=\"h6\">Besucher auswählen</Typography>\n        </Grid>\n      </Grid>\n      <Grid container spacing={4}>\n        <Grid item xs={12} sm={6}>\n          <Paper className={classes.contentContainer}>\n            <Grid container spacing={4}>\n              <Grid item xs={12} sm={6}>\n                <Input\n                  className={classes.input}\n                  placeholder={t('register-first-name')}\n                  value={formState.firstName}\n                  onChange={event =>\n                    setFormState({\n                      ...formState,\n                      firstName: event.target.value,\n                    })\n                  }\n                />\n              </Grid>\n              <Grid item xs={12} sm={6}>\n                <Input\n                  className={classes.input}\n                  placeholder={t('register-name')}\n                  value={formState.name}\n                  onChange={event =>\n                    setFormState({ ...formState, name: event.target.value })\n                  }\n                />\n              </Grid>\n            </Grid>\n            <Grid container spacing={4}>\n              <Grid item xs={12} sm={6}>\n                <Input\n                  className={classes.input}\n                  type=\"email\"\n                  placeholder={t('register-email')}\n                  value={formState.email}\n                  onChange={event =>\n                    setFormState({ ...formState, email: event.target.value })\n                  }\n                />\n              </Grid>\n              <Grid item xs={12} sm={6}>\n                <Input\n                  className={classes.input}\n                  placeholder={t('register-phone')}\n                  value={formState.phone}\n                  onChange={event =>\n                    setFormState({ ...formState, phone: event.target.value })\n                  }\n                />\n              </Grid>\n            </Grid>\n            <Grid container spacing={4}>\n              <Grid item xs={12} sm={6}>\n                <FormControl style={{ width: '100%' }}>\n                  <InputLabel>Gebäude</InputLabel>\n                  <Select\n                    value={formState.building}\n                    onChange={event => {\n                      setFormState({\n                        ...formState,\n                        building: event.target.value,\n                      });\n                      const rooms = buildings\n                        .filter((b: any) => b.id === event.target.value)\n                        .map((v: any) => v.raeume);\n                      if (rooms) setRooms(rooms[0]);\n                    }}\n                  >\n                    {buildings &&\n                      buildings.length > 0 &&\n                      buildings.map((building: any, index: number) => (\n                        <MenuItem key={index} value={building.id}>\n                          {building.bezeichnung}\n                        </MenuItem>\n                      ))}\n                  </Select>\n                </FormControl>\n              </Grid>\n              <Grid item xs={12} sm={6}>\n                <FormControl style={{ width: '100%' }}>\n                  <InputLabel>{t('property-rooms')}</InputLabel>\n                  {rooms && rooms.length > 0 && (\n                    <Select\n                      value={formState.rooms}\n                      onChange={event => {\n                        setFormState({\n                          ...formState,\n                          rooms: event.target.value,\n                        });\n                      }}\n                      input={<Input />}\n                    >\n                      {rooms.map((room: any, index: number) => {\n                        return (\n                          <MenuItem key={index} value={room.id}>\n                            {room.bezeichnung}\n                          </MenuItem>\n                        );\n                      })}\n                    </Select>\n                  )}\n                </FormControl>\n              </Grid>\n            </Grid>\n            <Grid container spacing={4}>\n              <Grid item xs={12} sm={6}>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={async () => {\n                    setFormState(INITIAL_FORM_STATE);\n                  }}\n                >\n                  {t('register')}\n                </Button>\n              </Grid>\n            </Grid>\n          </Paper>\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <Table\n            rows={state.rows}\n            rowsPerPageOptions={[25, 50, 100]}\n            count={state.count}\n            rowsPerPage={state.limit}\n            page={state.page}\n            onChangePage={(_: any, newPage: number) => {\n              const newSkip =\n                newPage > state.page\n                  ? state.skip + state.limit\n                  : state.skip - state.limit;\n              dispatch({\n                type: 'changePage',\n                payload: { skip: newSkip, page: newPage },\n              });\n            }}\n            onChangeRowsPerPage={event => {\n              const limit = Number(event.target.value);\n              dispatch({ type: 'changeRowsPerPage', payload: { limit } });\n            }}\n            uniqueId=\"id\"\n            toolbarSettings={{\n              title: 'Besucher',\n              tooltipSelected: {\n                title: 'Besucher auswählen',\n                icon: <InputIcon />,\n                onClick: ids => {\n                  if (ids.length) {\n                    const id = ids[0];\n                    const user = state.rows.filter(u => u.id === id);\n                    if (user.length)\n                      setFormState({\n                        id: user[0].id,\n                        firstName: user[0].vorname,\n                        name: user[0].nachname,\n                        email: user[0].email,\n                      });\n                  }\n                },\n              },\n            }}\n          />\n        </Grid>\n      </Grid>\n    </div>\n  );\n};\n\nexport default RegisterVisit;\n"],"mappings":"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","sourceRoot":""}