{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/stephangilli/projects/besuchernachweis/frontend/components/CancleVisit/index.tsx\";\n\nvar __jsx = React.createElement;\n\nfunction _createForOfIteratorHelper(o) { if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (o = _unsupportedIterableToArray(o))) { var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var it, normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(n); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport * as React from 'react';\nimport moment from 'moment';\nimport { Grid, Typography } from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport useRestClient from '../../hooks/useRestClient';\nimport useVisitorSearchReducer from '../../hooks/useVisitorSearchReducer';\nimport useTranslations from '../../hooks/useTranslations';\nimport Table from '../Table';\nimport useStyles from './style';\n\nfunction mapStateToReqBody(state) {\n  return {\n    skip: state.skip,\n    take: state.limit,\n    startzeit: state.search.startDate,\n    endzeit: state.search.endDate\n  };\n}\n\nvar CancleVisit = function CancleVisit() {\n  var reducer = useVisitorSearchReducer();\n\n  var _useRestClient = useRestClient(),\n      client = _useRestClient.client,\n      setIsLoading = _useRestClient.setIsLoading,\n      setHasError = _useRestClient.setHasError;\n\n  if (!reducer) return null;\n  var state = reducer.state,\n      dispatch = reducer.dispatch;\n\n  function getBesuchByFilter() {\n    var res;\n    return _regeneratorRuntime.async(function getBesuchByFilter$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(client.getBesuchByFilter(mapStateToReqBody(state)));\n\n          case 2:\n            res = _context.sent;\n            if (res) dispatch({\n              type: 'setVisitors',\n              payload: {\n                rows: res.map(function (p) {\n                  return {\n                    id: p.id,\n                    'start-date': \"\".concat(moment(p.startzeit).format('DD.MM.YYYY, HH:mm')),\n                    name: \"\".concat(p.besucher[0].person.name, \", \").concat(p.besucher[0].person.vorname),\n                    'property-rooms': p.raeume.map(function (r) {\n                      return \"\".concat(r.bezeichnung);\n                    }).join(', ')\n                  };\n                }),\n                count: res.length\n              }\n            });\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function setBesuchEndzeitpunkt(ids) {\n    var _iterator, _step, id;\n\n    return _regeneratorRuntime.async(function setBesuchEndzeitpunkt$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setIsLoading(true);\n            _context2.prev = 1;\n            _iterator = _createForOfIteratorHelper(ids);\n            _context2.prev = 3;\n\n            _iterator.s();\n\n          case 5:\n            if ((_step = _iterator.n()).done) {\n              _context2.next = 11;\n              break;\n            }\n\n            id = _step.value;\n            _context2.next = 9;\n            return _regeneratorRuntime.awrap(client.setBesuchEndzeitpunkt({\n              besuchId: Number(id),\n              endzeit: moment().toISOString()\n            }));\n\n          case 9:\n            _context2.next = 5;\n            break;\n\n          case 11:\n            _context2.next = 16;\n            break;\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](3);\n\n            _iterator.e(_context2.t0);\n\n          case 16:\n            _context2.prev = 16;\n\n            _iterator.f();\n\n            return _context2.finish(16);\n\n          case 19:\n            _context2.next = 21;\n            return _regeneratorRuntime.awrap(getBesuchByFilter());\n\n          case 21:\n            _context2.next = 27;\n            break;\n\n          case 23:\n            _context2.prev = 23;\n            _context2.t1 = _context2[\"catch\"](1);\n            setIsLoading(false);\n            setHasError(true);\n\n          case 27:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 23], [3, 13, 16, 19]], Promise);\n  }\n\n  React.useEffect(function () {\n    getBesuchByFilter();\n  }, [state.page, state.limit]);\n  var classes = useStyles();\n\n  var _useTranslations = useTranslations(),\n      t = _useTranslations.t;\n\n  return __jsx(\"div\", {\n    className: classes.root,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 5\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 4,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }, __jsx(Typography, {\n    variant: \"body1\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 11\n    }\n  }, t('administration')), __jsx(Typography, {\n    variant: \"h6\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 11\n    }\n  }, t('visitor-cancle')))), __jsx(Grid, {\n    container: true,\n    spacing: 4,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 9\n    }\n  }, __jsx(Table, {\n    rows: state.rows,\n    rowsPerPageOptions: [25, 50, 100],\n    count: state.count,\n    rowsPerPage: state.limit,\n    page: state.page,\n    onChangePage: function onChangePage(_, newPage) {\n      var newSkip = newPage > state.page ? state.skip + state.limit : state.skip - state.limit;\n      dispatch({\n        type: 'changePage',\n        payload: {\n          skip: newSkip,\n          page: newPage\n        }\n      });\n    },\n    onChangeRowsPerPage: function onChangeRowsPerPage(event) {\n      var limit = Number(event.target.value);\n      dispatch({\n        type: 'changeRowsPerPage',\n        payload: {\n          limit: limit\n        }\n      });\n    },\n    uniqueId: \"id\",\n    toolbarSettings: {\n      title: t('visitor-current-registered'),\n      tooltipSelected: {\n        title: t('visitor-cancle'),\n        icon: __jsx(InputIcon, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 23\n          }\n        }),\n        onClick: function onClick(ids) {\n          return _regeneratorRuntime.async(function onClick$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  return _context3.abrupt(\"return\", setBesuchEndzeitpunkt(ids));\n\n                case 1:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        }\n      }\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default CancleVisit;","map":{"version":3,"sources":["/Users/stephangilli/projects/besuchernachweis/frontend/components/CancleVisit/index.tsx"],"names":["React","moment","Grid","Typography","InputIcon","useRestClient","useVisitorSearchReducer","useTranslations","Table","useStyles","mapStateToReqBody","state","skip","take","limit","startzeit","search","startDate","endzeit","endDate","CancleVisit","reducer","client","setIsLoading","setHasError","dispatch","getBesuchByFilter","res","type","payload","rows","map","p","id","format","name","besucher","person","vorname","raeume","r","bezeichnung","join","count","length","setBesuchEndzeitpunkt","ids","besuchId","Number","toISOString","useEffect","page","classes","t","root","_","newPage","newSkip","event","target","value","title","tooltipSelected","icon","onClick"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport moment from 'moment';\nimport { Grid, Typography } from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport useRestClient from '../../hooks/useRestClient';\nimport useVisitorSearchReducer from '../../hooks/useVisitorSearchReducer';\nimport useTranslations from '../../hooks/useTranslations';\nimport Table from '../Table';\nimport useStyles from './style';\nimport { VisitorTableState, GetBesucherByFilterInput } from '../../types';\n\nfunction mapStateToReqBody(state: VisitorTableState): GetBesucherByFilterInput {\n  return {\n    skip: state.skip,\n    take: state.limit,\n    startzeit: state.search.startDate,\n    endzeit: state.search.endDate,\n  };\n}\n\nconst CancleVisit: React.FunctionComponent = () => {\n  const reducer = useVisitorSearchReducer();\n  const { client, setIsLoading, setHasError } = useRestClient();\n  if (!reducer) return null;\n\n  const { state, dispatch } = reducer;\n\n  async function getBesuchByFilter() {\n    const res = await client.getBesuchByFilter(mapStateToReqBody(state));\n\n    if (res)\n      dispatch({\n        type: 'setVisitors',\n        payload: {\n          rows: res.map(p => ({\n            id: p.id,\n            'start-date': `${moment(p.startzeit).format('DD.MM.YYYY, HH:mm')}`,\n            name: `${p.besucher[0].person.name}, ${p.besucher[0].person.vorname}`,\n            'property-rooms': p.raeume.map(r => `${r.bezeichnung}`).join(', '),\n          })),\n          count: res.length,\n        },\n      });\n  }\n\n  async function setBesuchEndzeitpunkt(ids: Array<string | number>) {\n    setIsLoading(true);\n    try {\n      for (const id of ids) {\n        await client.setBesuchEndzeitpunkt({\n          besuchId: Number(id),\n          endzeit: moment().toISOString(),\n        });\n      }\n      await getBesuchByFilter();\n    } catch (error) {\n      setIsLoading(false);\n      setHasError(true);\n    }\n  }\n\n  React.useEffect(() => {\n    getBesuchByFilter();\n  }, [state.page, state.limit]);\n\n  const classes = useStyles();\n  const { t } = useTranslations();\n  return (\n    <div className={classes.root}>\n      <Grid container spacing={4}>\n        <Grid item xs={12} sm={6}>\n          <Typography variant=\"body1\">{t('administration')}</Typography>\n          <Typography variant=\"h6\">{t('visitor-cancle')}</Typography>\n        </Grid>\n      </Grid>\n      <Grid container spacing={4}>\n        <Grid item xs={12}>\n          <Table\n            rows={state.rows}\n            rowsPerPageOptions={[25, 50, 100]}\n            count={state.count}\n            rowsPerPage={state.limit}\n            page={state.page}\n            onChangePage={(_: any, newPage: number) => {\n              const newSkip =\n                newPage > state.page\n                  ? state.skip + state.limit\n                  : state.skip - state.limit;\n              dispatch({\n                type: 'changePage',\n                payload: { skip: newSkip, page: newPage },\n              });\n            }}\n            onChangeRowsPerPage={event => {\n              const limit = Number(event.target.value);\n              dispatch({ type: 'changeRowsPerPage', payload: { limit } });\n            }}\n            uniqueId=\"id\"\n            toolbarSettings={{\n              title: t('visitor-current-registered'),\n              tooltipSelected: {\n                title: t('visitor-cancle'),\n                icon: <InputIcon />,\n                onClick: async ids => setBesuchEndzeitpunkt(ids),\n              },\n            }}\n          />\n        </Grid>\n      </Grid>\n    </div>\n  );\n};\n\nexport default CancleVisit;\n"]},"metadata":{},"sourceType":"module"}