{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nexport var defaultLocale = 'en';\nexport var locales = ['en', 'de'];\nvar DEFAULT_LOCALE = 'en';\nexport function isLocale(tested) {\n  return locales.some(function (locale) {\n    return locale === tested;\n  });\n}\nexport function detectLocale(req) {\n  if (req) {\n    var acceptLanugage = req.headers['accept-language'];\n\n    if (acceptLanugage) {\n      var requestedLocales = acceptLanugage.split(',').map(function (part) {\n        var _part$trim$split = part.trim().split(';q='),\n            _part$trim$split2 = _slicedToArray(_part$trim$split, 2),\n            locale = _part$trim$split2[0],\n            priority = _part$trim$split2[1];\n\n        return {\n          locale: locale,\n          priority: parseInt(priority)\n        };\n      });\n      requestedLocales.sort(function (a, b) {\n        return b.priority - a.priority;\n      });\n      var found = requestedLocales.find(function (_ref) {\n        var locale = _ref.locale;\n        return locale !== '*';\n      });\n      if (!found) return DEFAULT_LOCALE;else {\n        var locale = found.locale.split('-')[0];\n        if (locales.includes(locale)) return locale;else return DEFAULT_LOCALE;\n      }\n    }\n  }\n\n  if (typeof navigator !== 'undefined') {\n    var _locale = navigator.languages[0].split('-')[0];\n    if (_locale && locales.includes(_locale)) return _locale;else return DEFAULT_LOCALE;\n  }\n\n  return DEFAULT_LOCALE;\n}","map":{"version":3,"sources":["/Users/stephangilli/projects/besuchernachweis/frontend/utils/locales.ts"],"names":["defaultLocale","locales","DEFAULT_LOCALE","isLocale","tested","some","locale","detectLocale","req","acceptLanugage","headers","requestedLocales","split","map","part","trim","priority","parseInt","sort","a","b","found","find","includes","navigator","languages"],"mappings":";AAEA,OAAO,IAAMA,aAAa,GAAG,IAAtB;AACP,OAAO,IAAMC,OAAO,GAAG,CAAC,IAAD,EAAO,IAAP,CAAhB;AAEP,IAAMC,cAAc,GAAG,IAAvB;AAEA,OAAO,SAASC,QAAT,CAAkBC,MAAlB,EAAoD;AACzD,SAAOH,OAAO,CAACI,IAAR,CAAa,UAAAC,MAAM;AAAA,WAAIA,MAAM,KAAKF,MAAf;AAAA,GAAnB,CAAP;AACD;AAED,OAAO,SAASG,YAAT,CAAsBC,GAAtB,EAA0D;AAC/D,MAAIA,GAAJ,EAAS;AACP,QAAMC,cAAc,GAAGD,GAAG,CAACE,OAAJ,CAAY,iBAAZ,CAAvB;;AACA,QAAID,cAAJ,EAAoB;AAClB,UAAME,gBAAgB,GAAGF,cAAc,CAACG,KAAf,CAAqB,GAArB,EAA0BC,GAA1B,CAA8B,UAAAC,IAAI,EAAI;AAAA,+BAClCA,IAAI,CAACC,IAAL,GAAYH,KAAZ,CAAkB,KAAlB,CADkC;AAAA;AAAA,YACtDN,MADsD;AAAA,YAC9CU,QAD8C;;AAE7D,eAAO;AAAEV,UAAAA,MAAM,EAANA,MAAF;AAAUU,UAAAA,QAAQ,EAAEC,QAAQ,CAACD,QAAD;AAA5B,SAAP;AACD,OAHwB,CAAzB;AAIAL,MAAAA,gBAAgB,CAACO,IAAjB,CAAsB,UAACC,CAAD,EAAIC,CAAJ;AAAA,eAAUA,CAAC,CAACJ,QAAF,GAAaG,CAAC,CAACH,QAAzB;AAAA,OAAtB;AACA,UAAMK,KAAK,GAAGV,gBAAgB,CAACW,IAAjB,CAAsB;AAAA,YAAGhB,MAAH,QAAGA,MAAH;AAAA,eAAgBA,MAAM,KAAK,GAA3B;AAAA,OAAtB,CAAd;AACA,UAAI,CAACe,KAAL,EAAY,OAAOnB,cAAP,CAAZ,KACK;AACH,YAAMI,MAAM,GAAGe,KAAK,CAACf,MAAN,CAAaM,KAAb,CAAmB,GAAnB,EAAwB,CAAxB,CAAf;AACA,YAAIX,OAAO,CAACsB,QAAR,CAAiBjB,MAAjB,CAAJ,EAA8B,OAAOA,MAAP,CAA9B,KACK,OAAOJ,cAAP;AACN;AACF;AACF;;AAED,MAAI,OAAOsB,SAAP,KAAqB,WAAzB,EAAsC;AACpC,QAAMlB,OAAM,GAAGkB,SAAS,CAACC,SAAV,CAAoB,CAApB,EAAuBb,KAAvB,CAA6B,GAA7B,EAAkC,CAAlC,CAAf;AACA,QAAIN,OAAM,IAAIL,OAAO,CAACsB,QAAR,CAAiBjB,OAAjB,CAAd,EAAwC,OAAOA,OAAP,CAAxC,KACK,OAAOJ,cAAP;AACN;;AAED,SAAOA,cAAP;AACD","sourcesContent":["import * as http from 'http';\nimport { Locale } from '../types';\nexport const defaultLocale = 'en';\nexport const locales = ['en', 'de'];\n\nconst DEFAULT_LOCALE = 'en';\n\nexport function isLocale(tested: string): tested is Locale {\n  return locales.some(locale => locale === tested);\n}\n\nexport function detectLocale(req?: http.IncomingMessage): string {\n  if (req) {\n    const acceptLanugage = req.headers['accept-language'];\n    if (acceptLanugage) {\n      const requestedLocales = acceptLanugage.split(',').map(part => {\n        const [locale, priority] = part.trim().split(';q=');\n        return { locale, priority: parseInt(priority) };\n      });\n      requestedLocales.sort((a, b) => b.priority - a.priority);\n      const found = requestedLocales.find(({ locale }) => locale !== '*');\n      if (!found) return DEFAULT_LOCALE;\n      else {\n        const locale = found.locale.split('-')[0];\n        if (locales.includes(locale)) return locale;\n        else return DEFAULT_LOCALE;\n      }\n    }\n  }\n\n  if (typeof navigator !== 'undefined') {\n    const locale = navigator.languages[0].split('-')[0];\n    if (locale && locales.includes(locale)) return locale;\n    else return DEFAULT_LOCALE;\n  }\n\n  return DEFAULT_LOCALE;\n}\n"]},"metadata":{},"sourceType":"module"}