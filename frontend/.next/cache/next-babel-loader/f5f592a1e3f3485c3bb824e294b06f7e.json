{"ast":null,"code":"var _jsxFileName = \"/Users/stephangilli/projects/besuchernachweis/frontend/components/CancleVisit/index.tsx\";\nvar __jsx = React.createElement;\nimport * as React from 'react';\nimport moment from 'moment';\nimport { Grid, Typography } from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport useRestClient from '../../hooks/useRestClient';\nimport useVisitorSearchReducer from '../../hooks/useVisitorSearchReducer';\nimport useTranslations from '../../hooks/useTranslations';\nimport Table from '../Table';\nimport useStyles from './style';\n\nfunction mapStateToReqBody(state) {\n  return {\n    skip: state.skip,\n    take: state.limit,\n    startzeit: state.search.startDate,\n    endzeit: state.search.endDate\n  };\n}\n\nconst CancleVisit = () => {\n  const reducer = useVisitorSearchReducer();\n  const {\n    client,\n    setIsLoading,\n    setHasError\n  } = useRestClient();\n  if (!reducer) return null;\n  const {\n    state,\n    dispatch\n  } = reducer;\n\n  async function getBesucherByFilter() {\n    const res = await client.getBesucherByFilter(mapStateToReqBody(state));\n    if (res) dispatch({\n      type: 'setVisitors',\n      payload: {\n        rows: res,\n        count: res.length\n      }\n    });\n  }\n\n  async function setBesuchEndzeitpunkt(ids) {\n    setIsLoading(true);\n\n    try {\n      for (const id of ids) {\n        await client.setBesuchEndzeitpunkt({\n          besuchId: Number(id),\n          endzeit: moment().toISOString()\n        });\n      }\n\n      const res = await client.getBesucherByFilter(mapStateToReqBody(state));\n      console.log(res);\n      if (res) dispatch({\n        type: 'setVisitors',\n        payload: {\n          rows: res,\n          count: res.length\n        }\n      });\n    } catch (error) {\n      setIsLoading(false);\n      setHasError(true);\n    }\n  }\n\n  React.useEffect(() => {\n    getBesucherByFilter();\n  }, [state.page, state.limit]);\n  const classes = useStyles();\n  const {\n    t\n  } = useTranslations();\n  return __jsx(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 5\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }, __jsx(Typography, {\n    variant: \"body1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }\n  }, t('administration')), __jsx(Typography, {\n    variant: \"h6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }, t('visitor-cancle')))), __jsx(Grid, {\n    container: true,\n    spacing: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }\n  }, __jsx(Table, {\n    rows: state.rows,\n    rowsPerPageOptions: [25, 50, 100],\n    count: state.count,\n    rowsPerPage: state.limit,\n    page: state.page,\n    onChangePage: (_, newPage) => {\n      const newSkip = newPage > state.page ? state.skip + state.limit : state.skip - state.limit;\n      dispatch({\n        type: 'changePage',\n        payload: {\n          skip: newSkip,\n          page: newPage\n        }\n      });\n    },\n    onChangeRowsPerPage: event => {\n      const limit = Number(event.target.value);\n      dispatch({\n        type: 'changeRowsPerPage',\n        payload: {\n          limit\n        }\n      });\n    },\n    uniqueId: \"id\",\n    toolbarSettings: {\n      title: t('visitor-current-registered'),\n      tooltipSelected: {\n        title: t('visitor-cancle'),\n        icon: __jsx(InputIcon, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 23\n          }\n        }),\n        onClick: async ids => setBesuchEndzeitpunkt(ids)\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default CancleVisit;","map":{"version":3,"sources":["/Users/stephangilli/projects/besuchernachweis/frontend/components/CancleVisit/index.tsx"],"names":["React","moment","Grid","Typography","InputIcon","useRestClient","useVisitorSearchReducer","useTranslations","Table","useStyles","mapStateToReqBody","state","skip","take","limit","startzeit","search","startDate","endzeit","endDate","CancleVisit","reducer","client","setIsLoading","setHasError","dispatch","getBesucherByFilter","res","type","payload","rows","count","length","setBesuchEndzeitpunkt","ids","id","besuchId","Number","toISOString","console","log","error","useEffect","page","classes","t","root","_","newPage","newSkip","event","target","value","title","tooltipSelected","icon","onClick"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport moment from 'moment';\nimport { Grid, Typography } from '@material-ui/core';\nimport InputIcon from '@material-ui/icons/Input';\nimport useRestClient from '../../hooks/useRestClient';\nimport useVisitorSearchReducer from '../../hooks/useVisitorSearchReducer';\nimport useTranslations from '../../hooks/useTranslations';\nimport Table from '../Table';\nimport useStyles from './style';\nimport { VisitorTableState, GetBesucherByFilterInput } from '../../types';\n\nfunction mapStateToReqBody(state: VisitorTableState): GetBesucherByFilterInput {\n  return {\n    skip: state.skip,\n    take: state.limit,\n    startzeit: state.search.startDate,\n    endzeit: state.search.endDate,\n  };\n}\n\nconst CancleVisit: React.FunctionComponent = () => {\n  const reducer = useVisitorSearchReducer();\n  const { client, setIsLoading, setHasError } = useRestClient();\n  if (!reducer) return null;\n\n  const { state, dispatch } = reducer;\n\n  async function getBesucherByFilter() {\n    const res = await client.getBesucherByFilter(mapStateToReqBody(state));\n    if (res)\n      dispatch({\n        type: 'setVisitors',\n        payload: { rows: res, count: res.length },\n      });\n  }\n\n  async function setBesuchEndzeitpunkt(ids: Array<string | number>) {\n    setIsLoading(true);\n    try {\n      for (const id of ids) {\n        await client.setBesuchEndzeitpunkt({\n          besuchId: Number(id),\n          endzeit: moment().toISOString(),\n        });\n      }\n      const res = await client.getBesucherByFilter(mapStateToReqBody(state));\n      console.log(res);\n      if (res)\n        dispatch({\n          type: 'setVisitors',\n          payload: { rows: res, count: res.length },\n        });\n    } catch (error) {\n      setIsLoading(false);\n      setHasError(true);\n    }\n  }\n\n  React.useEffect(() => {\n    getBesucherByFilter();\n  }, [state.page, state.limit]);\n\n  const classes = useStyles();\n  const { t } = useTranslations();\n  return (\n    <div className={classes.root}>\n      <Grid container spacing={4}>\n        <Grid item xs={12} sm={6}>\n          <Typography variant=\"body1\">{t('administration')}</Typography>\n          <Typography variant=\"h6\">{t('visitor-cancle')}</Typography>\n        </Grid>\n      </Grid>\n      <Grid container spacing={4}>\n        <Grid item xs={12}>\n          <Table\n            rows={state.rows}\n            rowsPerPageOptions={[25, 50, 100]}\n            count={state.count}\n            rowsPerPage={state.limit}\n            page={state.page}\n            onChangePage={(_: any, newPage: number) => {\n              const newSkip =\n                newPage > state.page\n                  ? state.skip + state.limit\n                  : state.skip - state.limit;\n              dispatch({\n                type: 'changePage',\n                payload: { skip: newSkip, page: newPage },\n              });\n            }}\n            onChangeRowsPerPage={event => {\n              const limit = Number(event.target.value);\n              dispatch({ type: 'changeRowsPerPage', payload: { limit } });\n            }}\n            uniqueId=\"id\"\n            toolbarSettings={{\n              title: t('visitor-current-registered'),\n              tooltipSelected: {\n                title: t('visitor-cancle'),\n                icon: <InputIcon />,\n                onClick: async ids => setBesuchEndzeitpunkt(ids),\n              },\n            }}\n          />\n        </Grid>\n      </Grid>\n    </div>\n  );\n};\n\nexport default CancleVisit;\n"]},"metadata":{},"sourceType":"module"}